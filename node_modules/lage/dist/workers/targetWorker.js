"use strict";var e=require("worker_threads"),t=require("events"),r=require("stream"),s=require("readline"),n=require("async_hooks"),o=require("crypto"),i=require("os"),a=require("path"),c=require("url");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function d(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}var p=u(e),l=u(t),h=u(r),f=u(s),g=u(n),y=u(o),m=u(i),k=u(a),w=u(c);function b(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v={},P={},M={},_={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(e,{START_MARKER_PREFIX:()=>t,END_MARKER_PREFIX:()=>r,startMarker:()=>s,endMarker:()=>n});const t="## WORKER:START:",r="## WORKER:END:";function s(e){return`${t}${e}`}function n(e){return`${r}${e}`}}(_),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"registerWorker",{enumerable:!0,get:()=>s});const t=p.default,r=_;function s(e){t.parentPort?.on("message",(async s=>{let n;switch(s.type){case"start":return n=new AbortController,s.task&&await async function(s,n,o){try{process.stdout.write(`${(0,r.startMarker)(s)}\n`),process.stderr.write(`${(0,r.startMarker)(s)}\n`);const i=await e(n,o);t.parentPort?.postMessage({type:"status",err:void 0,results:i})}catch(e){t.parentPort?.postMessage({type:"status",err:e,results:void 0})}finally{process.stdout.write(`${(0,r.endMarker)(s)}\n`),process.stderr.write(`${(0,r.endMarker)(s)}\n`)}}(s.id,s.task,n.signal);case"abort":return n?.abort();case"check-memory-usage":return function(e){const t={type:"report-memory-usage",memoryUsage:process.memoryUsage().heapUsed};e.postMessage(t)}(t.parentPort)}}))}}(M);var T={},W={},O={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"createFilteredStreamTransform",{enumerable:!0,get:()=>s});const t=h.default,r=_;function s(){return new t.Transform({transform(e,t,s){let n=e.toString();n.includes(r.START_MARKER_PREFIX)&&(n=n.replace(new RegExp(r.START_MARKER_PREFIX+"[0-9a-z]{64}\n"),"")),n.includes(r.END_MARKER_PREFIX)&&(n=n.replace(new RegExp(r.END_MARKER_PREFIX+"[0-9a-z]{64}\n"),"")),s(null,n)}})}}(O);var j={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"TaskInfo",{enumerable:!0,get:()=>r});const t=g.default;class r extends t.AsyncResource{get id(){return this.options.id}get weight(){return this.options.weight}get abortSignal(){return this.options.abortSignal}done(e,t){const{cleanup:r,worker:s,resolve:n,reject:o}=this.options;r&&this.runInAsyncScope(r,null,s),e?this.runInAsyncScope(o,null,e,s):this.runInAsyncScope(n,null,t,s),this.emitDestroy()}constructor(e){super("WorkerPoolTaskInfo"),this.options=e,e.setup&&this.runInAsyncScope(e.setup,null,e.worker,e.worker.stdout,e.worker.stderr)}}}(j),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"ThreadWorker",{enumerable:!0,get:()=>$});const t=O,r=f.default,s=_,n=l.default,o=h.default,i=j,a=p.default,c=M(y.default),u=M(m.default);function d(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function g(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function k(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,g(e,t,"get"))}function w(e,t,r){d(e,t),t.set(e,r)}function b(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,g(e,t,"set"),r),r}function v(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function P(e,t){d(e,t),t.add(e)}function M(e){return e&&e.__esModule?e:{default:e}}const T="free";var W=new WeakMap,x=new WeakMap,I=new WeakMap,S=new WeakMap,E=new WeakSet,R=new WeakSet,D=new WeakSet,A=new WeakSet;class $ extends n.EventEmitter{start(e,t){this.status="busy";const{task:r,resolve:s,reject:n,cleanup:o,setup:a}=e;t?.addEventListener("abort",v(this,A,F));const u=c.default.randomBytes(32).toString("hex");b(this,W,new i.TaskInfo({id:u,weight:e.weight,cleanup:o,resolve:s,reject:n,worker:this,setup:a,abortSignal:t})),k(this,x).promise=new Promise((e=>{k(this,x).resolve=e})),k(this,I).promise=new Promise((e=>{k(this,I).resolve=e})),k(this,S).postMessage({type:"start",task:{...r,weight:e.weight},id:u})}get weight(){return k(this,W)?.weight??1}get stdout(){return k(this,x).stream}get stderr(){return k(this,I).stream}get resourceLimits(){return k(this,S).resourceLimits}get threadId(){return k(this,S).threadId}terminate(){k(this,S).removeAllListeners(),k(this,S).terminate(),k(this,S).unref()}restart(){this.restarts++,this.status="busy",k(this,S).terminate(),v(this,E,B).call(this)}async checkMemoryUsage(){k(this,S).postMessage({type:"check-memory-usage"})}constructor(e,t){super(),P(this,E),P(this,R),P(this,D),P(this,A),w(this,W,{writable:!0,value:void 0}),w(this,x,{writable:!0,value:void 0}),w(this,I,{writable:!0,value:void 0}),w(this,S,{writable:!0,value:void 0}),this.script=e,this.options=t,b(this,x,{stream:new o.Readable,promise:Promise.resolve(),resolve:()=>{}}),b(this,I,{stream:new o.Readable,promise:Promise.resolve(),resolve:()=>{}}),this.status="busy",this.restarts=0,this.maxWorkerMemoryUsage=0,v(this,E,B).call(this)}}function B(){const{workerOptions:e}=this.options,r=this.script,s=new a.Worker(r,{...e,stdout:!0,stderr:!0});v(this,D,U).call(this,s);const n=s.stdout.pipe((0,t.createFilteredStreamTransform)()),o=s.stderr.pipe((0,t.createFilteredStreamTransform)());let i=()=>{};const c=new Promise((e=>{i=e,e()}));let d=()=>{};const p=new Promise((e=>{d=e,e()}));s.on("message",(e=>{if("status"===e.type)Promise.all([k(this,x).promise,k(this,I).promise]).then((()=>{const{err:t,results:r}=e;k(this,W)&&(k(this,W).abortSignal?.removeEventListener("abort",v(this,A,F)),k(this,W).done(t,r)),this.checkMemoryUsage()}));else if("report-memory-usage"===e.type){this.maxWorkerMemoryUsage=Math.max(this.maxWorkerMemoryUsage,e.memoryUsage);const t=this.options.workerIdleMemoryLimit??u.default.totalmem();t&&e.memoryUsage>t?this.restart():v(this,R,N).call(this)}}));s.on("error",(e=>{Promise.all([k(this,x).promise,k(this,I).promise]).then((()=>{k(this,W)&&k(this,W).done(e,null),this.emit("error",e),this.restart()}))})),b(this,S,s),b(this,x,{stream:n,promise:c,resolve:i}),b(this,I,{stream:o,promise:p,resolve:d}),v(this,R,N).call(this)}function N(){let e=1;k(this,W)&&(e=k(this,W).weight,b(this,W,void 0)),this.status="free",this.emit(T,{weight:e})}function U(e){const t=e.stdout,n=(0,r.createInterface)({input:t,crlfDelay:1/0}),o=e.stderr,i=(0,r.createInterface)({input:o,crlfDelay:1/0}),a=e=>{let t,r=[];return n=>{k(this,W)&&(n.includes((0,s.startMarker)(k(this,W).id))?(r=[],t="stdout"===e?k(this,x).resolve:k(this,I).resolve):n.includes((0,s.endMarker)(k(this,W).id))?t():r.push(n))}},c=a("stdout"),u=a("stderr");n.on("line",c),i.on("line",u)}function F(){k(this,S).postMessage({type:"abort"})}}(W),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"WorkerPool",{enumerable:!0,get:()=>i});const t=l.default,r=W,s=n(m.default);function n(e){return e&&e.__esModule?e:{default:e}}const o="free";class i extends t.EventEmitter{get workerRestarts(){return this.workers.reduce(((e,t)=>e+t.restarts),0)}get maxWorkerMemoryUsage(){return this.workers.reduce(((e,t)=>Math.max(e,t.maxWorkerMemoryUsage)),0)}stats(){return{maxWorkerMemoryUsage:this.maxWorkerMemoryUsage,workerRestarts:this.workerRestarts}}ensureWorkers(){if(0===this.workers.length)for(let e=0;e<this.maxWorkers;e++)this.addNewWorker()}addNewWorker(){const{script:e,workerOptions:t}=this.options,s=new r.ThreadWorker(e,{workerOptions:t,workerIdleMemoryLimit:this.options.workerIdleMemoryLimit});s.on("free",(e=>{const{weight:t}=e;this.availability+=t,this.emit(o)})),this.workers.push(s)}exec(e,t,r,s,n){return n?.aborted?Promise.resolve():(t=Math.min(Math.max(1,t),this.maxWorkers),new Promise(((o,i)=>{this.queue.push({task:{...e,weight:t},weight:t,resolve:o,reject:i,cleanup:s,setup:r}),this._exec(n)})))}_exec(e){const t=this.queue.findIndex((e=>e.weight<=this.availability));if(-1===t)return;const r=this.workers.find((e=>"free"===e.status));if(r){const s=this.queue[t];this.queue.splice(t,1),this.availability-=s.weight,r.start(s,e)}}async close(){await Promise.all(this.workers.map((e=>e.terminate())))}constructor(e){super(),this.options=e,this.workers=[],this.freeWorkers=[],this.queue=[],this.maxWorkers=0,this.availability=0,this.maxWorkers=this.options.maxWorkers??s.default.cpus().length-1,this.availability=this.maxWorkers,this.workers=[],this.freeWorkers=[],this.queue=[],this.ensureWorkers(),this.on(o,(()=>{this.queue.length>0&&this._exec()}))}}}(T);var x={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AggregatedPool",{enumerable:!0,get:()=>r});const t=T;class r{stats(){return[...this.groupedPools.values(),this.defaultPool].reduce(((e,t)=>{if(t){const r=t.stats();e.maxWorkerMemoryUsage=Math.max(e.maxWorkerMemoryUsage,r.maxWorkerMemoryUsage),e.workerRestarts=e.workerRestarts+r.workerRestarts}return e}),{maxWorkerMemoryUsage:0,workerRestarts:0})}async exec(e,t,r,s,n){const o=this.options.groupBy(e),i=this.groupedPools.get(o)??this.defaultPool;if(!i)throw new Error(`No pool found to be able to run ${o} tasks, try adjusting the maxWorkers & concurrency values`);return i.exec(e,t,r,s,n)}async close(){const e=[...this.groupedPools.values(),this.defaultPool].map((e=>e?.close()));return Promise.all(e)}constructor(e){this.options=e,this.groupedPools=new Map;const{maxWorkers:r,maxWorkersByGroup:s,script:n,workerOptions:o}=e;let i=0;for(const[r,a]of s.entries()){const s=new t.WorkerPool({maxWorkers:a,workerOptions:o,script:n,workerIdleMemoryLimit:e.workerIdleMemoryLimit});this.groupedPools.set(r,s),i+=a}if(i>r)throw new Error(`Total maxWorkers (${i}) configured across all groups exceeds concurrency (${r}). Try reducing the maxWorkers, or increasing the --concurrency CLI argument, or separate the tasks to be run`);const a=r-i;a>0&&(this.defaultPool=new t.WorkerPool({maxWorkers:a,workerOptions:o,script:n,workerIdleMemoryLimit:e.workerIdleMemoryLimit})),this.options.logger.verbose(`Workers pools created:  ${[...s.entries(),["default",a]].map((([e,t])=>`${e} (${t})`)).join(", ")}`)}}}(x),function(e){Object.defineProperty(e,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(e,{registerWorker:()=>t.registerWorker,WorkerPool:()=>r.WorkerPool,AggregatedPool:()=>s.AggregatedPool});const t=M,r=T,s=x}(P);var I={},S={},E={};!function(e){function t(e){return e.sort(((e,t)=>(t.priority??0)-(e.priority??0)))}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"sortTargetsByPriority",{enumerable:!0,get:()=>t})}(E);var R={};!function(e){function t(e,t){return`${"string"==typeof e?e:""}#${t}`}function r(e){if(e.includes("#")){const t=e.split("#");return e.startsWith("#")||"//"===t[0]?{packageName:void 0,task:t[1]}:{packageName:t[0],task:t[1]}}return{packageName:void 0,task:e}}Object.defineProperty(e,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(e,{getTargetId:()=>t,getPackageAndTask:()=>r,getStartTargetId:()=>n});const s="__start";function n(){return s}}(R);var D={};!function(e){function t(e){const t=new Map;for(const[s]of e.entries())if(!t.has(s)){const n=r(e,t,s);if(n.length>0)return{hasCycle:!0,cycle:n}}return{hasCycle:!1}}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"detectCycles",{enumerable:!0,get:()=>t});const r=(e,t,r)=>{const s=[{node:r,traversing:!1}];for(;s.length>0;){const r=s[s.length-1];if(r.traversing)t.set(r.node,!1),s.pop();else{if(t.has(r.node)){if(t.get(r.node)){const e=s.filter((e=>e.traversing)).map((e=>e.node));return e.slice(e.indexOf(r.node))}s.pop();continue}t.set(r.node,!0),s[s.length-1]={...r,traversing:!0};const n=e.get(r.node);if(!n)throw new Error(`Could not find node "${r.node}" in the graph`);s.push(...[...n.dependents].map((e=>({node:e,traversing:!1}))))}}return[]}}(D);var A={},$={},B={};Object.defineProperty(B,"__esModule",{value:!0}),B.getPackageDependencies=void 0,B.getPackageDependencies=function(e,t,r={withDevDependencies:!0}){const s={...e.dependencies,...r.withDevDependencies&&e.devDependencies,...r.withPeerDependencies&&e.peerDependencies};return Object.keys(t).filter((e=>!!s[e]))},Object.defineProperty($,"__esModule",{value:!0}),$.createDependencyMap=void 0;const N=B;$.createDependencyMap=function(e,t={withDevDependencies:!0,withPeerDependencies:!1}){const r={dependencies:new Map,dependents:new Map};for(const[s,n]of Object.entries(e)){const o=(0,N.getPackageDependencies)(n,e,t);for(const e of o)r.dependencies.has(s)||r.dependencies.set(s,new Set),r.dependencies.get(s).add(e),r.dependents.has(e)||r.dependents.set(e,new Set),r.dependents.get(e).add(s)}return r};var U={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"expandDepSpecs",{enumerable:!0,get:()=>r});const t=R;function r(e,r){const s=[],o=(e,t)=>{s.push([e,t])},i=(e,t)=>t?a.filter((r=>{const{task:s,packageName:n}=r;return s===e&&t.some((e=>e===n))})).map((e=>e.id)):a.filter((t=>t.task===e)).map((e=>e.id)),a=[...e.values()];for(const c of a){const{depSpecs:a,packageName:u,id:d}=c;if(s.push([(0,t.getStartTargetId)(),d]),a&&0!==a.length)for(const s of a)if(s.includes("#")){const{packageName:e,task:r}=(0,t.getPackageAndTask)(s);o((0,t.getTargetId)(e,r),d)}else if(s.startsWith("^^")&&u){const e=i(s.substring(2),[...n(u,r)??[]]);for(const t of e)o(t,d)}else if(s.startsWith("^")&&u){const e=i(s.substring(1),[...r.dependencies.get(u)??[]]);for(const t of e)o(t,d)}else if(u){const r=s;e.has((0,t.getTargetId)(u,r))&&o((0,t.getTargetId)(u,r),d)}else{if(s.startsWith("^"))throw new Error(`invalid pipeline config detected: ${c.id}, packageName: ${u}, dep: ${s}`);{const e=i(s);for(const t of e)o(t,d)}}}return s}const s=new Map;function n(e,t){const r=s.get(e);if(r)return"walk-in-progress"===r?new Set:r;{s.set(e,"walk-in-progress");const r=[...t.dependencies.get(e)??[]],o=new Set(r);for(const e of r)for(const r of n(e,t))o.add(r);return s.set(e,o),o}}}(U);var F={},q={};!function(e){function t(e,t){const r=[],s=new Map([...e.entries()].map((([e,t])=>[e,new Set(t.dependencies)])));const n=[...t];for(;n.length>0;){const t=n.pop();r.push(t);e.get(t).dependents.forEach((e=>{const r=s.get(e);r.delete(t),0===r.size&&n.push(e)}))}return r}function r(e){const r=new Map,s=function(e){const t=[];for(const[r,s]of e)0===s.dependencies.length&&t.push(r);return t}(e),n=t(e,s);for(const t of n){const s=e.get(t),n=s.priority||0,o=s.dependencies.map((e=>{const t=r.get(e);if(void 0===t)throw new Error(`Expected to have already computed the cumulative priority for node ${e}`);return t})),i=n+Math.max(...o,0);r.set(t,i)}for(const t of e.values()){const e=r.get(t.id);if(void 0===e)throw new Error(`Expected to have already computed the cumulative priority for node ${t.id}`);t.priority=e}}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"prioritize",{enumerable:!0,get:()=>r})}(q),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"TargetGraphBuilder",{enumerable:!0,get:()=>n});const t=R,r=q,s=D;class n{addTarget(e){return this.targets.set(e.id,e),this.addDependency((0,t.getStartTargetId)(),e.id),e}addDependency(e,t){if(this.targets.has(t)){const r=this.targets.get(t);r.dependencies.includes(e)||r.dependencies.push(e)}if(this.targets.has(e)){const r=this.targets.get(e);r.dependents.includes(t)||r.dependents.push(t)}}build(){const e=(0,s.detectCycles)(this.targets);if(e.hasCycle)throw new Error("Cycles detected in the target graph: "+e.cycle.concat(e.cycle[0]).join(" -> "));return(0,r.prioritize)(this.targets),{targets:this.targets}}subgraph(e){const r=new n,s=[],o=[];for(const t of e)if(this.targets.has(t)){const e=this.targets.get(t);r.addTarget({...e,dependencies:[],dependents:[]}),o.push(t)}for(;o.length>0;){const e=o.shift();if(s.includes(e))continue;s.push(e);const n=this.targets.get(e);if(!n)throw new Error("Subgraph builder failed - target not found: "+e);for(const s of n.dependencies)s!==(0,t.getStartTargetId)()&&(r.targets.has(s)||r.addTarget({...this.targets.get(s),dependencies:[],dependents:[]}),r.addDependency(s,e)),o.push(s)}return r.build()}constructor(){this.targets=new Map;const e=(0,t.getStartTargetId)();this.targets.set(e,{id:e,task:e,cwd:"",label:"Start",hidden:!0,dependencies:[],dependents:[],depSpecs:[],weight:1,priority:0})}}}(F);var G={},L={};!function(e){function t(e,t,r){return"number"==typeof t?t:"function"==typeof t?t(e,r):1}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getWeight",{enumerable:!0,get:()=>t})}(L),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"TargetFactory",{enumerable:!0,get:()=>s});const t=R,r=L;class s{createPackageTarget(e,s,n){const{resolve:o}=this.options,{options:i,deps:a,dependsOn:c,cache:u,inputs:d,outputs:p,priority:l,maxWorkers:h,environmentGlob:f,weight:g}=n,y=o(e),m={id:(0,t.getTargetId)(e,s),label:`${e} - ${s}`,type:n.type,packageName:e,task:s,cache:!1!==u,cwd:y,depSpecs:c??a??[],dependencies:[],dependents:[],inputs:d,outputs:p,priority:l,maxWorkers:h,environmentGlob:f,weight:1,options:i};return m.weight=(0,r.getWeight)(m,g,h),m}createGlobalTarget(e,s){const{root:n}=this.options,{options:o,deps:i,dependsOn:a,inputs:c,outputs:u,priority:d,maxWorkers:p,environmentGlob:l,weight:h}=s,{task:f}=(0,t.getPackageAndTask)(e),g={id:e,label:e,type:s.type,task:f,cache:!1,cwd:n,depSpecs:a??i??[],dependencies:[],dependents:[],inputs:c,outputs:u,priority:d,maxWorkers:p,environmentGlob:l,weight:1,options:o};return g.weight=(0,r.getWeight)(g,h,p),g}constructor(e){this.options=e}}}(G),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"WorkspaceTargetGraphBuilder",{enumerable:!0,get:()=>c});const t=$,r=R,s=U,n=a(k.default),o=F,i=G;function a(e){return e&&e.__esModule?e:{default:e}}class c{addTargetConfig(e,t={}){if(e.startsWith("//")||e.startsWith("#")){const r=this.targetFactory.createGlobalTarget(e,t);this.graphBuilder.addTarget(r)}else if(e.includes("#")){const{packageName:s,task:n}=(0,r.getPackageAndTask)(e),o=this.targetFactory.createPackageTarget(s,n,t);this.graphBuilder.addTarget(o)}else{const r=Object.keys(this.packageInfos);for(const s of r){const r=e,n=this.targetFactory.createPackageTarget(s,r,t);this.graphBuilder.addTarget(n)}}}build(e,t){const n=(0,s.expandDepSpecs)(this.graphBuilder.targets,this.dependencyMap);for(const[e,t]of n)this.graphBuilder.addDependency(e,t);const o=[];for(const s of e)if(t)for(const e of t)o.push((0,r.getTargetId)(e,s));else for(const e of Object.keys(this.packageInfos))o.push((0,r.getTargetId)(e,s));return{targets:this.graphBuilder.subgraph(o).targets}}constructor(e,r){this.packageInfos=r,this.dependencyMap=(0,t.createDependencyMap)(r,{withDevDependencies:!0,withPeerDependencies:!1}),this.graphBuilder=new o.TargetGraphBuilder,this.targetFactory=new i.TargetFactory({root:e,resolve:e=>n.default.dirname(r[e].packageJsonPath)})}}}(A),function(e){Object.defineProperty(e,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(e,{sortTargetsByPriority:()=>t.sortTargetsByPriority,getTargetId:()=>r.getTargetId,getStartTargetId:()=>r.getStartTargetId,detectCycles:()=>s.detectCycles,WorkspaceTargetGraphBuilder:()=>n.WorkspaceTargetGraphBuilder,TargetGraphBuilder:()=>o.TargetGraphBuilder,TargetFactory:()=>i.TargetFactory});const t=E,r=R,s=D,n=A,o=F,i=G}(S),function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"TargetRunnerPicker",{enumerable:!0,get:()=>o});const t=n(k.default),r=S,s=w.default;function n(e){return e&&e.__esModule?e:{default:e}}class o{async pick(e){if(e.id===(0,r.getStartTargetId)())return(await Promise.resolve().then((function(){return H}))).NoOpRunner;if(e.type||(e.type="npmScript"),this.options[e.type]){const r=this.options[e.type],{script:n,options:o}=r;let i=n;i.startsWith("file://")||(i=(0,s.pathToFileURL)(i).toString());const a=await import(i),c=t.default.basename(n),u=c.replace(t.default.extname(c),"");return new("function"==typeof a[u]?a[u]:"function"==typeof a.default?a.default:"function"==typeof a.default[u]?a.default[u]:a)(o)}throw new Error(`No runner found for target ${e.id}`)}constructor(e){this.options=e}}}(I),Object.defineProperty(v,"__esModule",{value:!0});const C=P,K=I,z=p.default;const{runnerPicker:X}=function(e){const{runners:t}=e;return{runnerPicker:new K.TargetRunnerPicker(t)}}(z.workerData);(0,C.registerWorker)((async function(e,t){const r=await X.pick(e.target);await r.run({...e,abortSignal:t})}));var J={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NoOpRunner",{enumerable:!0,get:()=>t});const t={shouldRun:async()=>!0,async run(){}}}(J);var H=d({__proto__:null,default:b(J)},[J]);module.exports=v;
//# sourceMappingURL=targetWorker.js.map
